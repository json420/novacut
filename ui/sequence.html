<!doctype html>
<html>
<head>
<title>Sequence Interface</title>

<script src="js/jquery-1.6.2.min.js"></script>
<script src="js/jquery-ui-1.8.14.custom.min.js"></script>
<script src="js/video.js"></script>
<script src="js/data.js"></script>
<script src="js/scroll.js"></script>
<script>

var selected = null;
var docs = {};

function thumbnail(_id, i) {
    return ['/novacut', _id, i + '.jpg'].join('/');
}

function step(id, position, value){
	if (position == "start"){
		if (docs[id].start > 0 && value < 0){
			docs[id].start += value;
		}
		else if (docs[id].start < docs[id].stop - 1 && value > 0){
			docs[id].start += value;
		}
	}
	else if (position == "stop"){
		if (docs[id].stop < docs[id].frames - 1 && value > 0){
			docs[id].stop += value;
		}
		else if (docs[id].start < docs[id].stop - 1 && value < 0){
			docs[id].stop += value;
		}
	}
}

$(document).ready(function(){
    data.forEach(function(doc){
        docs[doc._id] = doc;
        var div = $('<div>', {'class': 'sequence_member', 'id': doc._id});
        div.append(
            $('<img>', {'src': thumbnail(doc._id, doc.start)})
        );
        div.append(
            $('<img>', {'src': thumbnail(doc._id, doc.stop)})
        );
        $('#sequence1').append(div);

        div.click(function() {
            if (div.hasClass('selected')) {
                return;
            }
            if (selected) {
                $('#' + selected).removeClass('selected');
            }
            div.addClass('selected');
            selected = doc._id;
        });
        div.children("img").mousewheel(function(e, d, dx, dy) {
            /* if over the top image, adjust start. Otherwise adjust end */
            if (e.target == $('#' + doc._id + ' :first-child')[0]) {
                step(doc._id, "start", -dy);
            } else {
                step(doc._id, "stop", -dy);
            }
            e.preventDefault();
            $('#' + doc._id + ' :first-child').attr('src', thumbnail(doc._id, doc.start));
            $('#' + doc._id + ' :last-child').attr('src', thumbnail(doc._id, doc.stop));
        });

    });
    $('#sequence1').sortable({'axis': 'x', 'opacity': 0.6});
    $(document).keydown(function(event) {
	    if (!selected) {
    	    return;
    	}
    	var doc = docs[selected];
	
		//If the left key is pressed, step start back 1 frame
		if (event.keyCode == '37') {
			step(doc._id, "start", -1);
		}
		//If the right key is pressed, step start forward 1 frame
		else if (event.keyCode == '39') {
			step(doc._id, "start", 1);
		}
		//If the up key is pressed, step end back 1 frame
		else if (event.keyCode == '38') {
    	    step(doc._id, "stop", -1);
		}
		//If the down key is pressed, step end forward 1 frame
		else if (event.keyCode == '40') {
    	    step(doc._id, "stop", 1);
		}
		else {
		    return;
		}
	
		event.preventDefault();
    	$('#' + doc._id + ' :first-child').attr('src', thumbnail(doc._id, doc.start));
    	$('#' + doc._id + ' :last-child').attr('src', thumbnail(doc._id, doc.stop));
	});
});


</script>
<style type="text/css">

body{
	background: #111;]
	margin:0px;
	padding:0px;
}

.sequence {
    background: #080808;
    background:linear-gradient(top, #080808, #111);
    background:-webkit-linear-gradient(top, #080808, #111);
    background:-moz-linear-gradient(top, #080808, #111);
    background:-o-linear-gradient(top, #080808, #111);
    position:absolute;
    bottom:50%;
    margin-bottom:-94px;
    left:10px;
    right:10px;
    border-top:1px solid #333
}

.sequence_member {
    display: inline-block;
    background:#333;
    background:linear-gradient(top, #444, #333);
    background:-webkit-linear-gradient(top, #444, #333);
    background:-moz-linear-gradient(top, #444, #333);
    background:-o-linear-gradient(top, #444, #333);
    margin: 0px;
    border-radius:3px;
    border-top:1px solid #666;
    border-left:1px solid #666;
    border-right:1px solid #222;
    border-bottom:1px solid #222;
}

.sequence_member.selected {
    border:1px solid #e81f3b;
}

.sequence_member img {
    display: block;
    margin: 3px;
}
</style>
</head>

<body>

<div id="sequence1" class="sequence" />


</body>
</html>
