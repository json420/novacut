<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" href="style.css"/>
		<script src="couch.js"></script>
		<script src="/_apps/dc3/base.js"></script>
		<script>
			// The `novacut` CouchDB database:
			
			function init(){
				db = new couch.Database('novacut');
				project = db.get("fakeproject");
				for (var i = 0; i < project.clips.length; i++){
					var name = project.clips[i]
					var img = $el("img", {src: "/novacut/" + name + "/1.jpg"});
					var li = $el("li", {"data-src": name})
					li.appendChild(img);
					$("clips").appendChild(li);
					
					li.onmouseover = function(){
						$("preview").src = "/novacut/media/" + this.dataset.src + ".webm";
						$("preview").pause();
					}
					
					li.onmousedown = function(){
						$("preview").play();
					}
				}
			}
			
			function on_changes(response) {
				response.results.forEach(function(row) {
					console.log(row.doc._id);
				});
	 
				
			}

			function monitor() {
				var since = db.get().update_seq;
				m = db.monitor_changes(on_changes, since)
			}

			window.onload = function(){
				init();
				monitor();
			}
		</script>
	</head>
	<body>
		<ul id="clips">
		</ul>
		<video id="preview" width="480" height="270" autoplay>
		</video>
	</body>
</html>
