<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<style>
			body {
				font-family: "Ubuntu Mono";
				font-size: 18px;
				background-color: #333;
				color: #e81f3b;
				text-align: center;
			}
		</style>
		<script src="couch.js"></script>
		<script src="/_apps/dc3/base.js"></script>
		<script>
			// The `novacut` CouchDB database:
			var db = new couch.Database('novacut');

			var thing = db.get("magic_test");

			function on_changes(response) {
				var div = $('change');
				response.results.forEach(function(row) {
					if (row.doc._id == "magic_test"){
						var el = $("change");
						el.style.setProperty("top", thing.y + "px");
						el.style.setProperty("left", thing.x + "px");
						el.style.setProperty("background-color", thing.colour);
					}
				});
	 
				/*div.textContent = '';
				r.results.forEach(function(row) {
					var p = $el('p', {textContent: JSON.stringify(row.doc)});
					div.appendChild(p);
				});*/
			}

			function monitor() {
				var since = db.get().update_seq;
				//$('change').textContent = 'starting at update_seq ' + since;
				m = db.monitor_changes(on_changes, since)
			}

			window.onload = function(){
				monitor();
				var el = $("change");
				el.style.setProperty("display", "inline-block");
				el.style.setProperty("position", "absolute");
				el.style.setProperty("width", "200px");
				el.style.setProperty("height", "200px");
				el.style.setProperty("top", thing.y + "px");
				el.style.setProperty("left", thing.x + "px");
				el.style.setProperty("background-color", thing.colour);
				
				document.onmousedown = function(event){
					thing.x = event.clientX;
					thing.y = event.clientY;
					db.save(thing);
				}
			}
		</script>
	</head>
	<body>
		<div id="change"></div>
	</body>
</html>
