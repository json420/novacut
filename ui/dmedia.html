<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style>
body {
    font-family: "Ubuntu Mono";
    font-size: 18px;
    background-color: #333;
    color: #e81f3b;
}

div.thumb {
    margin: 4px;
    padding: 0;
    background: #fff;
    height: 216px;
    width: 216px;
    display: inline-block;
    background-position: center center;
}

</style>
<script src="couch.js"></script>
<script src="/_apps/dc3/base.js"></script>
<script>
// The `novacut` CouchDB database:
var db = new couch.Database('dmedia');


function append(parent, doc) {
    var div = $el('div', {'class': 'thumb'});
    if (doc._attachments.thumbnail) {
        div.style.backgroundImage = 'url("' + db.att_url(doc, 'thumbnail') + '")';   
    }
    parent.appendChild(div);
}


function on_changes(r) {
    var parent = $('hello');
    r['results'].forEach(function(row) {
        var doc = row.doc;
        if (doc.type == 'dmedia/file' && doc.origin == 'user' && doc._attachments.thumbnail) {
            append(parent, doc);
        }
    });
}

function monitor() {
    var since = db.get().update_seq;
    var m = db.monitor_changes(on_changes, since);
}


function show() {
    var r = db.view('user', 'ctime', {include_docs: true});
    var parent = $('hello');
    r['rows'].forEach(function(row) {
        append(parent, row.doc);
    });
}

</script>
</head>
<body onload="show()">
<div id="monitor"></div>
</body>
</html>
