<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style>
body {
    font-family: "Ubuntu Mono";
    font-size: 18px;
    background-color: #333;
    color: #e81f3b;
    text-align: center;
}
</style>
<script src="couch.js"></script>
<script src="/_apps/dc3/base.js"></script>
<script>
// The `novacut` CouchDB database:
var db = new couch.Database('dmedia');

function on_changes(r) {
    var div = $('hello');
    //div.textContent = '';
    r['results'].forEach(function(row) {
        var doc = row.doc;
        if (doc.type == 'dmedia/file' && doc.origin == 'user' && doc._attachments.thumbnail) {
            var img = $el('img', {
                src: db.att_url(doc, 'thumbnail'),
                title: doc.name,
            });
            div.appendChild(img);
            img.scrollIntoView();
        }
    });
}

function monitor() {
    var since = db.get().update_seq;
    var m = db.monitor_changes(on_changes, since)
}
</script>
</head>
<body onload="monitor()">
<div id="hello"></div>
</body>
</html>
